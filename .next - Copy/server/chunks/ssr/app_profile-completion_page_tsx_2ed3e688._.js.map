{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/offic/OneDrive/Documents/PROJECTS%20LIVE%20NOW/your-portal/app/profile-completion/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { Box, Button, TextField, Typography, Paper, Grid, CircularProgress, Avatar, Alert } from '@mui/material';\r\nimport { styled } from '@mui/material/styles';\r\nimport { Person as PersonIcon, Phone as PhoneIcon, CloudUpload as UploadIcon, CheckCircle as CheckIcon } from '@mui/icons-material';\r\nimport { useRouter } from 'next/navigation';\r\nimport { toast } from 'react-hot-toast';\r\nimport Cookies from 'js-cookie';\r\n\r\nconst theme = { primaryColor: '#00ED64', secondaryColor: '#0A0F19' };\r\n\r\nconst StyledPaper = styled(Paper)(() => ({\r\n  background: '#ffffff',\r\n  borderRadius: '16px',\r\n  boxShadow: '0 10px 20px rgba(0, 0, 0, 0.1)',\r\n  padding: '24px',\r\n}));\r\n\r\nconst StyledButton = styled(Button)(() => ({\r\n  background: theme.primaryColor,\r\n  color: theme.secondaryColor,\r\n  borderRadius: '8px',\r\n  fontWeight: 600,\r\n  '&:hover': { background: '#00C653' },\r\n  '&:disabled': { background: '#e0e0e0', color: '#999' },\r\n}));\r\n\r\nconst StyledTextField = styled(TextField)(() => ({\r\n  '& .MuiOutlinedInput-root': { borderRadius: '8px', '&.Mui-focused fieldset': { borderColor: theme.primaryColor } },\r\n  '& .MuiInputLabel-root.Mui-focused': { color: theme.primaryColor },\r\n}));\r\n\r\nconst UploadArea = styled(Box)<{ isDragging: boolean }>(({ isDragging }) => ({\r\n  border: `2px dashed ${isDragging ? theme.primaryColor : '#e0e0e0'}`,\r\n  borderRadius: '12px',\r\n  padding: '16px',\r\n  textAlign: 'center',\r\n  backgroundColor: isDragging ? 'rgba(0, 237, 100, 0.05)' : '#fafafa',\r\n  cursor: 'pointer',\r\n}));\r\n\r\ninterface FormState { fullName: string; phoneNumber: string; }\r\n\r\nexport default function ProfileCompletionPage() {\r\n  const router = useRouter();\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n  const [formState, setFormState] = useState<FormState>({ fullName: '', phoneNumber: '' });\r\n  const [croppedImage, setCroppedImage] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n  const [initialLoading, setInitialLoading] = useState<boolean>(true);\r\n  const [errorMsg, setErrorMsg] = useState<string>('');\r\n  const [isDragging, setIsDragging] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    const email = Cookies.get('email');\r\n    if (!email) {\r\n      router.push('/login');\r\n      return;\r\n    }\r\n    fetch(`/api/user-profile?email=${email}`)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data.success) {\r\n          setFormState({ fullName: data.fullName || '', phoneNumber: data.phoneNumber || '' });\r\n          setCroppedImage(data.image || null);\r\n        }\r\n      })\r\n      .catch(() => setErrorMsg('Failed to load profile'))\r\n      .finally(() => setInitialLoading(false));\r\n  }, [router]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setFormState({ ...formState, [e.target.name]: e.target.value });\r\n    setErrorMsg('');\r\n  };\r\n\r\n  const onSelectFile = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files?.[0]) {\r\n      const file = e.target.files[0];\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        setErrorMsg('File size should be less than 5MB'); toast.error('File size should be less than 5MB'); return;\r\n      }\r\n      if (!file.type.startsWith('image/')) {\r\n        setErrorMsg('Please select a valid image file'); toast.error('Please select a valid image file'); return;\r\n      }\r\n      const reader = new FileReader();\r\n      reader.onload = () => { setCroppedImage(reader.result as string); toast.success('Image uploaded successfully!'); };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    if (e.dataTransfer.files?.[0]?.type.startsWith('image/')) {\r\n      const file = e.dataTransfer.files[0];\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        setErrorMsg('File size should be less than 5MB'); toast.error('File size should be less than 5MB'); return;\r\n      }\r\n      const reader = new FileReader();\r\n      reader.onload = () => { setCroppedImage(reader.result as string); toast.success('Image uploaded successfully!'); };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    if (!formState.fullName.trim()) { setErrorMsg('Full name is required'); toast.error('Full name is required'); return false; }\r\n    if (!/^\\+?\\d{10,15}$/.test(formState.phoneNumber.trim())) {\r\n      setErrorMsg('Please enter a valid phone number (e.g., +919876543210)'); toast.error('Please enter a valid phone number'); return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!validateForm()) return;\r\n    setLoading(true); setErrorMsg('');\r\n    try {\r\n      const email = Cookies.get('email');\r\n      if (!email) throw new Error('No email found');\r\n      const res = await fetch(`/api/user-profile?email=${email}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ fullName: formState.fullName, phoneNumber: formState.phoneNumber, image: croppedImage }),\r\n      });\r\n      if (!res.ok) throw new Error((await res.json()).message || 'Failed to save profile');\r\n      toast.success('Profile saved successfully!');\r\n      router.push('/dashboard');\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Something went wrong';\r\n      setErrorMsg(message); toast.error(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (initialLoading) return <Box sx={{ minHeight: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}><CircularProgress sx={{ color: theme.primaryColor }} /></Box>;\r\n\r\n  return (\r\n    <Box sx={{ minHeight: '100vh', py: 4, px: 2, background: '#f4f4f4' }}>\r\n      <StyledPaper sx={{ maxWidth: 800, mx: 'auto' }}>\r\n        <Typography variant=\"h4\" sx={{ textAlign: 'center', mb: 2, fontWeight: 600 }}>Complete Your Profile</Typography>\r\n        {errorMsg && <Alert severity=\"error\" sx={{ mb: 2 }}>{errorMsg}</Alert>}\r\n        <Grid container spacing={3}>\r\n          <Grid item xs={12} md={6}>\r\n            <StyledTextField fullWidth label=\"Full Name\" name=\"fullName\" value={formState.fullName} onChange={handleInputChange} error={!!errorMsg && !formState.fullName.trim()} InputProps={{ startAdornment: <PersonIcon sx={{ mr: 1, color: '#999' }} /> }} />\r\n            <StyledTextField fullWidth label=\"Phone Number\" name=\"phoneNumber\" value={formState.phoneNumber} onChange={handleInputChange} error={!!errorMsg && !formState.phoneNumber.trim()} sx={{ mt: 2 }} InputProps={{ startAdornment: <PhoneIcon sx={{ mr: 1, color: '#999' }} /> }} />\r\n          </Grid>\r\n          <Grid item xs={12} md={6}>\r\n            <UploadArea isDragging={isDragging} onDrop={handleDrop} onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }} onDragLeave={() => setIsDragging(false)} onClick={() => fileInputRef.current?.click()}>\r\n              <UploadIcon sx={{ fontSize: 40, color: isDragging ? theme.primaryColor : '#999' }} />\r\n              <Typography sx={{ fontWeight: 600 }}>Upload Profile Picture</Typography>\r\n              <Typography sx={{ color: '#666', fontSize: '0.85rem' }}>Click or drag and drop (Max 5MB, JPG/PNG)</Typography>\r\n              <input ref={fileInputRef} type=\"file\" accept=\"image/*\" style={{ display: 'none' }} onChange={onSelectFile} />\r\n            </UploadArea>\r\n            {croppedImage && <Avatar src={croppedImage} sx={{ width: 80, height: 80, mt: 2, mx: 'auto', border: `2px solid ${theme.primaryColor}` }} />}\r\n          </Grid>\r\n        </Grid>\r\n        <StyledButton fullWidth onClick={handleSubmit} disabled={loading || !formState.fullName.trim() || !formState.phoneNumber.trim()} sx={{ mt: 3, py: 1.2 }}>\r\n          {loading ? <CircularProgress size={24} sx={{ color: theme.secondaryColor }} /> : <><CheckIcon sx={{ mr: 1 }} />Save Profile</>}\r\n        </StyledButton>\r\n      </StyledPaper>\r\n    </Box>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}